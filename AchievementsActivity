package com.SIMATS.rise;

import android.content.Intent;
import android.content.SharedPreferences;
import android.os.Bundle;
import android. view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.ProgressBar;
import android.widget.TextView;

import androidx.appcompat.app.AppCompatActivity;

public class AchievementsActivity extends AppCompatActivity {

    ProgressBar levelProgressBar;
    TextView levelText;
    LinearLayout badgeContainer;
    int completedTasks = 0;
    int level = 0;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_achievements);

        levelProgressBar = findViewById(R.id.levelProgressBar);
        levelText = findViewById(R.id.levelText);
        badgeContainer = findViewById(R.id.badgeContainer);
        Button backButton = findViewById(R.id.backButton);

        // ✅ Load completedTasks from intent or SharedPreferences
        SharedPreferences prefs = getSharedPreferences("RisePrefs", MODE_PRIVATE);
        completedTasks = getIntent().getIntExtra("completed_tasks", -1);

        if (completedTasks == -1) {
            // No data passed from intent, load from saved preferences
            completedTasks = prefs.getInt("completed_tasks", 0);
        } else {
            // Save the value for future access
            SharedPreferences.Editor editor = prefs.edit();
            editor.putInt("completed_tasks", completedTasks);
            editor.apply();
        }

        // ✅ Calculate level
        level = completedTasks / 3;
        if (level > 10) level = 10;

        // ✅ Set level display and progress bar
        levelProgressBar.setProgress(level);
        levelText.setText("Level : " + level);

        // ✅ Show badges based on completed task count
        showBadges(completedTasks);

        // ✅ Back button logic
        backButton.setOnClickListener(v -> {
            Intent intent = new Intent(AchievementsActivity.this, DashboardActivity.class);
            startActivity(intent);
            finish();
        });
    }

    // Optional XML onClick
    public void goToDashboard(View view) {
        Intent intent = new Intent(this, DashboardActivity.class);
        startActivity(intent);
        finish();
    }

    private void showBadges(int completedCount) {
        badgeContainer.removeAllViews();

        if (completedCount >= 5) {
            addBadge(R.drawable.water);
        }
        if (completedCount >= 10) {
            addBadge(R.drawable.sun);
        }
        if (completedCount >= 15) {
            addBadge(R.drawable.fire);
        }
        if (completedCount >= 20) {
            addBadge(R.drawable.fullmoon);
        }
        if (completedCount >= 30) {
            addBadge(R.drawable.badge);
        }
    }

    private void addBadge(int drawableId) {
        ImageView badge = new ImageView(this);
        badge.setImageResource(drawableId);

        LinearLayout.LayoutParams params = new LinearLayout.LayoutParams(150, 150);
        params.setMargins(16, 0, 16, 0);
        badge.setLayoutParams(params);

        badgeContainer.addView(badge);
    }
}
