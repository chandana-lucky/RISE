package com.SIMATS.rise;

import android.content.Intent;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.ProgressBar;
import android.widget.TextView;

import androidx.appcompat.app.AppCompatActivity;

public class CompanionStatusActivity extends AppCompatActivity {

    ImageView companionImage;
    ProgressBar growthProgress;
    TextView currentLevelLabel;
    Button backButton;
    int completedTasks;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_companion_status);

        companionImage = findViewById(R.id.companionImage);
        growthProgress = findViewById(R.id.growthProgress);
        currentLevelLabel = findViewById(R.id.currentLevelLabel);
        backButton = findViewById(R.id.backButton);

        // ✅ Get completed task count from SharedPreferences
        SharedPreferences prefs = getSharedPreferences("RisePrefs", MODE_PRIVATE);
        completedTasks = prefs.getInt("completed_tasks", 0); // Default 0 if not set

        // ✅ Set growth bar progress out of 30 max
        int progress = Math.min((completedTasks * 100) / 30, 100);
        growthProgress.setProgress(progress);

        // ✅ Set the correct companion stage based on completedTasks
        updateCompanionStage(completedTasks);

        // ✅ Back button logic
        backButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Intent intent = new Intent(CompanionStatusActivity.this, DashboardActivity.class);
                intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_NEW_TASK);
                startActivity(intent);
                finish();
            }
        });
    }

    private void updateCompanionStage(int completed) {
        String stageName = "Seed";
        String drawableName = "stage1_seed";

        if (completed >= 7 && completed <= 12) {
            stageName = "Sprouting Leaf";
            drawableName = "stage2_sprout";
        } else if (completed >= 13 && completed <= 18) {
            stageName = "Leaf Grows";
            drawableName = "stage3_leaf";
        } else if (completed >= 19 && completed <= 24) {
            stageName = "Stem Forms";
            drawableName = "stage4_stem";
        } else if (completed >= 25) {
            stageName = "Full Plant";
            drawableName = "stage5_fullplant";
        }

        currentLevelLabel.setText(stageName);

        // ✅ Set image dynamically by name
        int imageResId = getResources().getIdentifier(drawableName, "drawable", getPackageName());
        if (imageResId != 0) {
            companionImage.setImageResource(imageResId);
        }
    }
    public void goToDashboard(View view) {
        Intent intent = new Intent(CompanionStatusActivity.this, DashboardActivity.class);
        startActivity(intent);
        finish();
    }

}
